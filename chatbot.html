<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Araddha â€” Chatbot</title>
  <style>
    :root{
      --bg:#e6f7f5; --card:#ffffff; --accent: #0f766e; --muted:#64748b;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#0f172a}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px;}
    .chat-container{
      width:420px; max-width:96vw; background:var(--card); border-radius:14px; padding:18px; box-shadow:0 12px 40px rgba(12,34,25,.08);
      display:flex;flex-direction:column; gap:12px;
    }
    .header{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#6ae6c6,#2d9c90);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;
      box-shadow:0 8px 22px rgba(11,46,40,.08);
    }
    h1{font-size:1.05rem;margin:0}
    p.subtitle{margin:0;font-size:.88rem;color:var(--muted)}
    .messages{
      height:360px; overflow-y:auto; padding:12px; border-radius:10px;
      border:1px solid #eef2f3; background:linear-gradient(180deg, #fbfffe, #f6fffb);
      display:flex;flex-direction:column;gap:8px;
    }
    .msg{max-width:86%;padding:10px 12px;border-radius:12px;line-height:1.35;word-break:break-word;}
    .me{align-self:flex-end;background:#dcf4eb;color:#064e47;border-bottom-right-radius:6px}
    .bot{align-self:flex-start;background:#f1f6f5;color:#064e47;border-bottom-left-radius:6px}
    .meta{font-size:.74rem;color:var(--muted);margin-top:4px}
    .controls{display:flex;gap:8px;align-items:center}
    .input{
      flex:1; padding:10px 12px;border-radius:10px;border:1px solid #dbe7e3;background:#fff;outline:none;font-size:.97rem;
    }
    .btn{
      padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:#fff;cursor:pointer;font-weight:600;
      box-shadow:0 8px 18px rgba(14,64,62,.06);
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .status{font-size:.78rem;color:var(--muted);text-align:center;margin-top:4px}
    .small{font-size:.82rem;color:var(--muted)}
    .loader{display:inline-block;margin-left:8px}
    @media(max-width:480px){
      .messages{height:60vh}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="chat-container" role="application" aria-label="Araddha chat">
      <div class="header">
        <div class="logo">A</div>
        <div>
          <h1>Araddha â€” your all-time buddy ðŸ’¬</h1>
          <p class="subtitle">Ask anything. I'm here to help â€” 24/7.</p>
        </div>
      </div>

      <div id="messages" class="messages" aria-live="polite"></div>

      <div class="controls" aria-hidden="false">
        <input id="userInput" class="input" placeholder="Type your message and press Enter or Send..." aria-label="Message input" />
        <button id="sendBtn" class="btn">Send</button>
      </div>

      <div class="status small" id="status">Server: <span id="serverState">unknown</span></div>
    </div>
  </div>

  <script>
    // ======= CONFIGURE THIS ========
    // If your backend runs locally with the Flask example provided, keep this URL:
    const backendUrl = "http://127.0.0.1:5000/chat";
    // If you deploy backend to some public URL, replace backendUrl accordingly.
    // ===============================

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const serverStateEl = document.getElementById("serverState");

    function appendMessage(text, who = "bot") {
      const container = document.createElement("div");
      container.className = "msg " + (who === "me" ? "me" : "bot");
      container.innerHTML = text;
      messagesEl.appendChild(container);
      messagesEl.scrollTop = messagesEl.scrollHeight - messagesEl.clientHeight + 100;
    }

    // small helper to show status
    function setServerState(text, color) {
      serverStateEl.textContent = text;
      if (color) serverStateEl.style.color = color;
      else serverStateEl.style.color = "";
    }

    // Ping server to update status (optional)
    async function checkServer() {
      try {
        const res = await fetch(backendUrl.replace(/\/chat$/, "/"), { method: "GET" });
        if (res.ok) {
          setServerState("online", "green");
        } else {
          setServerState("unreachable (" + res.status + ")", "orange");
        }
      } catch (e) {
        setServerState("offline", "red");
      }
    }

    // Core send function
    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = "";
      appendMessage("<b>You:</b> " + escapeHtml(text), "me");

      // disable UI while waiting
      sendBtn.disabled = true;
      inputEl.disabled = true;
      const loader = document.createElement("span");
      loader.className = "loader small";
      loader.textContent = "Thinking..."; // visible text for accessibility
      sendBtn.textContent = "";
      sendBtn.appendChild(loader);

      try {
        const res = await fetch(backendUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) {
          const msg = `Server error: ${res.status} ${res.statusText}`;
          appendMessage("<b>Bot:</b> " + escapeHtml(msg));
          setServerState("unreachable", "orange");
        } else {
          const data = await res.json();
          const reply = data?.reply ?? "(no reply)";
          appendMessage("<b>Bot:</b> " + escapeHtml(reply));
          setServerState("online", "green");
        }
      } catch (err) {
        appendMessage("<b>Bot:</b> Failed to contact backend â€” " + escapeHtml(err.message || err));
        setServerState("offline", "red");
        console.error("Fetch error:", err);
      } finally {
        // restore UI
        sendBtn.disabled = false;
        inputEl.disabled = false;
        sendBtn.textContent = "Send";
        inputEl.focus();
      }
    }

    // small utility to prevent HTML injection
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, function (m) {
        return ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m];
      });
    }

    // keyboard send
    inputEl.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    sendBtn.addEventListener("click", sendMessage);

    // initial server check
    checkServer();
    // optional: re-check every 20s
    setInterval(checkServer, 20000);

    // if you want to preload a welcome message
    appendMessage("<b>Bot:</b> Hello! I'm Araddha â€” ask me anything. ðŸ™‚");
    inputEl.focus();

  </script>
</body>
</html>

