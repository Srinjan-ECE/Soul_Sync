<!-- sos.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Soul Sync ‚Äî SOS</title>
<style>
  /* Teal + Sea Green theme with animated background and modern UI */
  :root{
    --bg1:#dcf4eb; --accent-1:#2aa79a; --accent-2:#47b49e; --accent-3:#58d7c1;
    --cta:#ff7a59; --muted:#6b7280; --card:#ffffff; --glass:rgba(255,255,255,0.6);
    --glass-2:rgba(255,255,255,0.08);
  }
  *{box-sizing:border-box;font-family:Inter, Poppins, system-ui, -apple-system; }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),#e6fbf3);color:#043029;}
  .container{max-width:980px;margin:28px auto;padding:20px;position:relative;z-index:5;}
  .navbar{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px;border-radius:14px;
    background:linear-gradient(90deg,var(--accent-2),var(--accent-1));box-shadow:0 8px 30px rgba(10,40,35,.08);color:#fff;}
  .brand{display:flex;gap:12px;align-items:center;font-weight:600;}
  /* logo box updated to include image */
  .logo{
    width:48px;height:48px;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center;
    box-shadow:0 6px 18px rgba(9,55,48,.12);background:linear-gradient(135deg,#76f3da 0%,#24b79e 100%);
    transition:transform .22s, box-shadow .22s;
    flex-shrink:0;
  }
  .logo img{width:100%;height:100%;object-fit:cover;display:block;}
  .logo.pulse{animation:logo-pulse 3.2s infinite ease-in-out;}
  .logo:hover{transform:scale(1.06);box-shadow:0 14px 32px rgba(10,70,60,.18);}

  @keyframes logo-pulse{
    0%{transform:scale(1);filter:drop-shadow(0 6px 12px rgba(10,50,45,.06))}
    50%{transform:scale(1.04);filter:drop-shadow(0 18px 36px rgba(10,70,60,.09))}
    100%{transform:scale(1);filter:drop-shadow(0 6px 12px rgba(10,50,45,.06))}
  }

  .nav-right a{color:#021915;text-decoration:none;background:rgba(255,255,255,.18);padding:8px 12px;border-radius:8px;font-weight:600;}
  .header{margin:18px 0;padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,.5),rgba(255,255,255,.3));box-shadow:0 6px 20px rgba(0,0,0,.04);}
  .header h1{margin:0;font-weight:700;font-size:1.6rem;color:#022a26;}
  .header p{margin:8px 0 0;color:var(--muted);}

  /* Animated hero graphic container */
  .hero{margin-top:14px; display:flex;gap:16px;align-items:stretch;}
  .card{flex:1;background:linear-gradient(180deg,var(--card),#f6fff9);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(8,40,36,.06);position:relative;overflow:hidden;}
  .card h3{margin:0 0 8px 0;color:#063a36;}
  .muted{color:var(--muted);font-size:.95rem}

  .flex{display:flex;gap:10px;align-items:center}
  .btn{appearance:none;border:0;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;font-weight:700;cursor:pointer;box-shadow:0 8px 26px rgba(14,56,50,.08);}
  .btn.ghost{background:transparent;color:var(--accent-2);border:1px solid rgba(4,40,35,.06);box-shadow:none}
  .btn.danger{background:linear-gradient(90deg,#ff6a6a,#ff7a59);}

  input[type="text"], textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e6f3ee;background:#fbfffd}
  small.note{display:block;margin-top:8px;color:var(--muted)}

  /* quick action tiles */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
  .tile{padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,.85),#fff);text-align:center;cursor:pointer;transition:transform .18s}
  .tile:hover{transform:translateY(-6px)}
  .tile .ico{width:48px;height:48px;border-radius:10px;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent-3),var(--accent-2));color:#022a26;font-weight:800}

  /* modal */
  .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(1,6,5,.32),rgba(1,6,5,.48));display:none;align-items:center;justify-content:center;z-index:120}
  .overlay.open{display:flex}
  .modal{width:min(720px,96%);background:#fff;border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,.28);max-height:86vh;overflow:auto}
  .modal h2{margin-top:0}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}

  /* safety plan */
  .safety-plan{display:flex;flex-direction:column;gap:8px;margin-top:10px;padding:12px;border-radius:10px;background:linear-gradient(90deg,#fbfff9,#f2fff7);border:1px dashed rgba(4,40,35,.06)}
  .small{font-size:.9rem;color:var(--muted)}

  /* animated background waves at bottom */
  .waves{position:fixed;right:-10%;bottom:-8%;width:60vmax;height:60vmax;pointer-events:none;z-index:1;opacity:.12;filter:blur(12px)}
  svg.wave{width:100%;height:100%}

  /* helper */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#021915;color:#aef0dd;padding:10px 16px;border-radius:999px;box-shadow:0 10px 30px rgba(5,30,25,.25);display:none;z-index:200}
  .toast.show{display:block;animation:pop .5s}
  @keyframes pop{0%{transform:translate(-50%,6px);opacity:0}100%{transform:translate(-50%,0);opacity:1}}

  /* responsive */
  @media(max-width:880px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media(max-width:520px){ .grid{grid-template-columns:repeat(1,1fr)} .hero{flex-direction:column} .navbar{flex-direction:column;gap:12px;align-items:flex-start} }
</style>
</head>
<body>

<div class="waves" aria-hidden="true">
  <!-- subtle decorative wave graphic -->
  <svg class="wave" viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
    <defs>
      <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#6fe8cf"/><stop offset="1" stop-color="#2fb59d"/></linearGradient>
    </defs>
    <g transform="translate(0,160)">
      <path d="M0,320 C150,200 300,260 480,240 C660,220 800,260 800,260 L800 800 L0 800 Z" fill="url(#g1)"/>
    </g>
  </svg>
</div>

<div class="container" role="main">
  <nav class="navbar" role="navigation" aria-label="Main">
    <div class="brand">
      <div class="logo pulse" title="Soul Sync logo">
        <!-- Update the path below if your file name differs. Place image under /images/ folder -->
        <img src="C:\Users\Srinjandeb\OneDrive\Desktop\Project Soul Sync\images" alt="Soul Sync Logo" onerror="this.onerror=null; this.src='C:\Users\Srinjandeb\OneDrive\Desktop\Project Soul Sync\images'">
      </div>
      <div style="color:#fff">Soul Sync</div>
    </div>
    <div class="nav-right"><a href="home.html">Home</a></div>
  </nav>

  <div class="header" role="banner">
    <h1>Emergency & SOS</h1>
    <p class="center">Quick actions to reach help. Use only in urgent situations. If you're in immediate danger, call local emergency services first.</p>
  </div>

  <div class="hero" role="region" aria-label="Emergency actions">
    <section class="card" aria-labelledby="actions-title">
      <h3 id="actions-title">Quick Actions</h3>
      <p class="muted">Tap to call, message, or share your location. All actions ask for confirmation first.</p>

      <div class="grid" style="margin-top:12px">
        <div class="tile" onclick="quickCall(112)" role="button" tabindex="0">
          <div class="ico">üìû</div>
          <strong>Call Emergency</strong>
          <div class="small">112 / Local</div>
        </div>

        <div class="tile" onclick="quickShareLocation()" role="button" tabindex="0">
          <div class="ico">üìç</div>
          <strong>Share Location</strong>
          <div class="small">Send your map link to guardian</div>
        </div>

        <div class="tile" onclick="openEscalationModal()" role="button" tabindex="0">
          <div class="ico">‚ö†Ô∏è</div>
          <strong>Escalation</strong>
          <div class="small">If chatbot detects high-risk</div>
        </div>
      </div>

      <hr style="margin:14px 0">

      <h3>Parents / Guardians</h3>
      <p class="muted">Set a trusted contact. Soul Sync will not contact them without your confirmation.</p>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <input id="guardian" type="text" inputmode="tel" placeholder="+91 12345 67890" />
        <button class="btn" onclick="saveGuardian()">Save</button>
      </div>
      <p id="gs" class="muted" style="margin-top:8px"></p>

      <div style="margin-top:12px;">
        <button class="btn ghost" onclick="openSafetyPlan()">Open Safety Plan</button>
        <small class="note">Create and save a short safety plan (local only).</small>
      </div>
    </section>

    <section class="card" aria-labelledby="help-title">
      <h3 id="help-title">If you're feeling suicidal</h3>
      <p class="muted">You are not alone. Immediate options:</p>

      <div style="margin-top:12px;">
        <button class="btn danger" onclick="openCrisisResources()">Call Suicide Helpline</button>
        <button class="btn ghost" onclick="openChatCrisis()">Open Crisis Chat</button>
        <small class="note">Links open in a new tab or dialer. We recommend calling emergency services if in immediate danger.</small>
      </div>

      <hr style="margin:12px 0">

      <h4>Tools</h4>
      <div class="small">Use the safety plan, reach out to a friend, or request local help. Soul Sync can prepare a suggested message you can send to a guardian ‚Äî you choose whether to send it.</div>

      <div style="margin-top:12px" class="flex">
        <button class="btn" onclick="prepareGuardianMessage()">Prepare Message</button>
        <button class="btn ghost" onclick="copyEmergencyLink()">Copy My Location Link</button>
      </div>
    </section>
  </div>

  <section style="margin-top:18px" class="card">
    <h3>Customize panic behavior</h3>
    <p class="muted">Select what happens when you press emergency quickly:</p>
    <div style="display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap;">
      <label><input type="checkbox" id="opt-call" checked /> Auto open call</label>
      <label style="margin-left:12px"><input type="checkbox" id="opt-sms" /> Open SMS composer</label>
      <label style="margin-left:12px"><input type="checkbox" id="opt-mail" /> Prepare email to guardian</label>
    </div>
    <small class="note">Even when selected, Soul Sync asks for confirmation before sending or calling.</small>

    <div style="margin-top:12px" class="flex">
      <button class="btn" onclick="panicPress()">Panic (simulate)</button>
      <button class="btn ghost" onclick="vibrateTest()">Vibrate Test</button>
    </div>
  </section>

</div>

<!-- Modal overlay (used by multiple flows) -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" id="modal" role="document">
    <h2 id="modal-title">Modal</h2>
    <div id="modal-body"></div>
    <div class="actions" id="modal-actions"></div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* -------------------------
   Utility helpers
   ------------------------- */
function toast(msg, ms=2500){
  const t = document.getElementById('toast');
  t.innerText = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), ms);
}

/* Modal API */
const overlay = document.getElementById('overlay');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const modalActions = document.getElementById('modal-actions');

function openModal(title, bodyHtml, actions=[]){
  modalTitle.innerText = title;
  modalBody.innerHTML = bodyHtml;
  modalActions.innerHTML = '';
  actions.forEach(a=>{
    const btn = document.createElement('button');
    btn.className = a.className || 'btn';
    btn.innerText = a.label;
    btn.onclick = ()=> { a.onClick(); };
    modalActions.appendChild(btn);
  });
  overlay.classList.add('open');
  overlay.setAttribute('aria-hidden','false');
}
function closeModal(){ overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }

/* save/show guardian */
const gEl = document.getElementById('guardian');
const gs = document.getElementById('gs');
function saveGuardian(){
  const v = gEl.value.trim();
  if(!v){ toast('Enter a valid number'); return; }
  localStorage.setItem('soul_guardian', v);
  gs.innerText = 'Saved guardian: ' + v;
  toast('Guardian saved');
}
const existing = localStorage.getItem('soul_guardian');
if(existing) { gs.innerText = 'Saved guardian: ' + existing; gEl.value = existing; }

/* quick call */
function quickCall(number){
  openModal('Call Emergency', `<p>Call <strong>${number}</strong> now?</p>`, [
    {label:'Call', className:'btn danger', onClick: ()=> { window.location.href = 'tel:' + number; }},
    {label:'Cancel', className:'btn ghost', onClick: closeModal}
  ]);
}

/* quick share location - ask geolocation and then sms composer */
function quickShareLocation(){
  const num = localStorage.getItem('soul_guardian');
  if(!num){ toast('No guardian set ‚Äî please save a number'); return; }
  if(!navigator.geolocation){ toast('Geolocation not available'); return; }
  openModal('Share your location', `<p>This will open your SMS app so you can send your location to <strong>${num}</strong>. Continue?</p>`, [
    {label:'Yes ‚Äî share', className:'btn', onClick: ()=> {
      toast('Getting location...');
      navigator.geolocation.getCurrentPosition(pos=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        const msg = encodeURIComponent(`I need help. My location: https://www.google.com/maps?q=${lat},${lon}`);
        closeModal();
        window.location.href = `sms:${num}?body=${msg}`;
      }, err=>{
        toast('Unable to get location');
      }, {timeout:8000});
    }},
    {label:'Cancel', className:'btn ghost', onClick: closeModal}
  ]);
}

/* copy emergency link */
function copyEmergencyLink(){
  if(!navigator.geolocation){ toast('Geolocation not available'); return; }
  toast('Getting location...');
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat = pos.coords.latitude, lon = pos.coords.longitude;
    const link = `https://www.google.com/maps?q=${lat},${lon}`;
    navigator.clipboard?.writeText(link).then(()=> toast('Location link copied'), ()=> toast('Copy failed'));
  }, ()=> toast('Unable to get location'), {timeout:7000});
}

/* prepare message to guardian (opens modal with editable text) */
function prepareGuardianMessage(){
  const num = localStorage.getItem('soul_guardian') || '';
  const sample = `I‚Äôm struggling and need help. Please check on me. My current location (if available) will be included. ‚ÄîSent via Soul Sync`;
  openModal('Prepare message to guardian', `<label>To: <input id="msg-to" type="text" value="${num}" style="width:100%;margin-top:8px" /></label>
    <label style="display:block;margin-top:10px">Message:<textarea id="msg-body" rows="5">${sample}</textarea></label>`, [
    {label:'Open SMS composer', className:'btn', onClick: ()=> {
      const to = document.getElementById('msg-to').value.trim(); const body = encodeURIComponent(document.getElementById('msg-body').value.trim());
      if(!to){ toast('Please enter guardian number'); return; }
      closeModal();
      window.location.href = `sms:${to}?body=${body}`;
    }},
    {label:'Copy message', className:'btn ghost', onClick: ()=> {
      const body = document.getElementById('msg-body').value.trim();
      navigator.clipboard?.writeText(body).then(()=> toast('Message copied'), ()=> toast('Copy failed'));
    }}
  ]);
}

/* open crisis resources */
function openCrisisResources(){
  openModal('Crisis resources', `<p>If you are thinking about suicide, please reach out immediately.</p>
    <ul>
      <li>India National Helpline: <strong>080-46209999</strong> (or check local numbers)</li>
      <li>International & chat resources: <a href="https://www.opencounseling.com/suicide-hotlines" target="_blank" rel="noopener">OpenCounseling</a></li>
    </ul>`, [
    {label:'Call local emergency', className:'btn danger', onClick: ()=> { window.location.href = 'tel:112'; }},
    {label:'Close', className:'btn ghost', onClick: closeModal}
  ]);
}

/* open crisis chat */
function openChatCrisis(){
  // You can replace with local/regional crisis chat links or Lottie-designed chat widget
  window.open('https://www.iasp.info/resources/Crisis_Centres/', '_blank', 'noopener');
}

/* safety plan (local only) */
function openSafetyPlan(){
  const stored = localStorage.getItem('soul_safety_plan') || '';
  const parsed = stored ? JSON.parse(stored) : {};
  openModal('My Safety Plan', `<div class="safety-plan">
    <label>Warning signs:<textarea id="sp-warning" rows="2">${parsed.warning || ''}</textarea></label>
    <label>People & places that help:<textarea id="sp-people" rows="2">${parsed.people || ''}</textarea></label>
    <label>Immediate coping actions:<textarea id="sp-coping" rows="2">${parsed.coping || ''}</textarea></label>
    <small class="small">Saved locally only on this device.</small>
  </div>`, [
    {label:'Save plan', className:'btn', onClick: ()=> {
      const plan = {
        warning: document.getElementById('sp-warning').value.trim(),
        people: document.getElementById('sp-people').value.trim(),
        coping: document.getElementById('sp-coping').value.trim(),
        updated: new Date().toISOString()
      };
      localStorage.setItem('soul_safety_plan', JSON.stringify(plan));
      closeModal();
      toast('Safety plan saved locally');
    }},
    {label:'Close', className:'btn ghost', onClick: closeModal}
  ]);
}

/* vibration test */
function vibrateTest(){ if(navigator.vibrate){ navigator.vibrate([200,100,200]); toast('Vibrate OK'); } else toast('Vibration not supported'); }

/* panic press simulates immediate actions based on preferences (but still asks for confirmation) */
function panicPress(){
  const call = document.getElementById('opt-call').checked;
  const sms = document.getElementById('opt-sms').checked;
  const mail = document.getElementById('opt-mail').checked;
  const actions = [];
  if(call) actions.push('open call');
  if(sms) actions.push('open SMS');
  if(mail) actions.push('prepare email');
  const prefText = `This will ${actions.length ? actions.join(', ') : 'do nothing'} ‚Äî confirm?`;
  openModal('Panic ‚Äî confirm actions', `<p>${prefText}</p>`, [
    {label:'Proceed', className:'btn danger', onClick: ()=> {
      closeModal();
      if(call) quickCall(112);
      else if(sms) prepareGuardianMessage();
      else toast('No action selected');
    }},
    {label:'Cancel', className:'btn ghost', onClick: closeModal}
  ]);
}

/* -------------------------
   Escalation flow when chatbot detects high risk
   - This is a *consent-first* flow. CHATBOT should call handleSuicideRiskDetected()
   ------------------------- */

function openEscalationModal(){ handleSuicideRiskDetected(); }

/**
 * Call this function from your chatbot when you detect a user at high-risk.
 * Example: when the bot decides "high risk", it should call:
 *   window.handleSuicideRiskDetected({source:'chatbot', details:'...optional...' })
 *
 * The function intentionally asks for user consent to contact others or call emergency services.
 */
window.handleSuicideRiskDetected = function(payload = {}){
  const extra = payload.note ? `<p class="small">Reason: ${payload.note}</p>` : '';
  const body = `<p style="font-weight:600">We detected signs that you may be at risk of self-harm or suicide. You are not alone. Would you like help right now?</p>
    ${extra}
    <p class="small">Choose an option below. Nothing will be sent without your confirmation.</p>
    <div style="margin-top:12px">
      <button class="btn" onclick="startCrisisAssist()">Yes ‚Äî I want help</button>
      <button class="btn ghost" onclick="showCopingOptions()">I need coping tools</button>
      <button class="btn ghost" onclick="closeModal()">Not now</button>
    </div>`;
  openModal('Immediate help', body, [
    { label:'Close', className:'btn ghost', onClick: closeModal}
  ]);
};

function showCopingOptions(){
  modalBody.innerHTML = `<h3>Short coping tools</h3>
    <ul>
      <li>Try grounding: name 5 things you can see, 4 you can touch, 3 you can hear.</li>
      <li>Slow breathing: inhale 4s, hold 4s, exhale 6s ‚Äî repeat for 2 minutes.</li>
      <li>Contact someone you trust or use chat resources.</li>
    </ul>
    <small class="small">If you feel unsafe at any time, choose "Escalate".</small>
    <div style="margin-top:10px" class="flex">
      <button class="btn" onclick="startCrisisAssist()">Escalate ‚Äî get immediate help</button>
      <button class="btn ghost" onclick="closeModal()">Back</button>
    </div>`;
  modalTitle.innerText = 'Coping tools';
}

function startCrisisAssist(){
  // ask explicit consent to contact someone or call emergency services
  modalBody.innerHTML = `<p>Please choose how you'd like us to help. Nothing will be sent without your confirmation.</p>
    <div style="margin-top:12px">
      <label style="display:block"><input type="checkbox" id="consent-call" /> Allow me to open a call to local emergency services</label>
      <label style="display:block;margin-top:6px"><input type="checkbox" id="consent-guardian" /> Allow me to help contact my guardian (open SMS or email)</label>
      <label style="display:block;margin-top:6px"><input type="checkbox" id="consent-shareloc" /> Allow sharing of my current location (opens SMS)</label>
    </div>
    <small class="small">We will never send messages silently. You will be shown and asked to confirm each message.</small>`;
  modalActions.innerHTML = '';
  const escalateBtn = document.createElement('button');
  escalateBtn.className = 'btn danger';
  escalateBtn.innerText = 'Proceed with selected actions';
  escalateBtn.onclick = ()=> {
    const c1 = document.getElementById('consent-call').checked;
    const c2 = document.getElementById('consent-guardian').checked;
    const c3 = document.getElementById('consent-shareloc').checked;
    if(c1){ quickCall(112); return; }
    if(c2){ prepareGuardianMessage(); return; }
    if(c3){ quickShareLocation(); return; }
    toast('Please select at least one action');
  };
  const cancel = document.createElement('button');
  cancel.className = 'btn ghost';
  cancel.innerText = 'Cancel';
  cancel.onclick = closeModal;
  modalActions.appendChild(cancel);
  modalActions.appendChild(escalateBtn);
  modalTitle.innerText = 'Escalation ‚Äî consent needed';
}

/* expose small helper for chatbot: provide reason text */
window.openEscalationWithReason = function(reasonText=''){
  handleSuicideRiskDetected({note:reasonText});
}

/* Accessibility: close modal on escape */
document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeModal(); });

/* End of script */
</script>

</body>
</html>
